#!/bin/sh

# Run lint-staged for frontend files (Biome) only if there are relevant files staged
STAGED_FRONTEND_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '^app/.*\.(js|ts|tsx|json)$' || true)
if [ -n "$STAGED_FRONTEND_FILES" ]; then
  echo "Running Biome on staged frontend files..."
  cd app
  npx lint-staged || exit 1
  cd ..
fi

# Run Ruff for Python backend files
STAGED_PY_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '^api/.*\.py$' || true)
if [ -n "$STAGED_PY_FILES" ]; then
  if command -v ruff >/dev/null 2>&1; then
    echo "Running Ruff on staged Python files..."
    echo "$STAGED_PY_FILES" | xargs ruff check --fix
    # Re-add fixed files to staging
    echo "$STAGED_PY_FILES" | xargs git add
  fi
fi

exit 0
